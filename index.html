<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Fiches Formateurs JCI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      padding: 20px;
    }
    #searchInput {
      margin-bottom: 20px;
      padding: 10px;
      width: 100%;
      max-width: 400px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .card {
      border: 1px solid #ddd;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      background: #ffffff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      max-width: 600px;
    }
    .highlight {
      background-color: #ffffcc;
    }
  </style>
</head>
<body>

  <h1>Fiches Formateurs JCI</h1>
  <input type="text" id="searchInput" placeholder="Rechercher par nom, session ou domaine de formation">

  <div id="cards"></div>

  <script>
    async function fetchData() {
      const sheetId = '1BsWqxe-softpUYlAaCDj8bh-GezzM2hFvqog7rFVjRg';
      const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

      const response = await fetch(url);
      const text = await response.text();
      const json = JSON.parse(text.substring(47).slice(0, -2));
      const headers = json.table.cols.map(col => col.label.trim());

      // Identify relevant columns
      const nameIndex = headers.findIndex(h => h.toLowerCase().includes("nom et prénom"));
      const domainesIndex = headers.findIndex(h => h.toLowerCase().includes("domaines de formation"));
      const sessionsIndex = headers.findIndex(h => h.toLowerCase().includes("sessions"));
      const emailIndex = headers.findIndex(h => h.toLowerCase().includes("email"));
      const phoneIndex = headers.findIndex(h => h.toLowerCase().includes("téléphone"));
      const orgIndex = headers.findIndex(h => h.toLowerCase().includes("organisation"));
      const publicIndex = headers.findIndex(h => h.toLowerCase().includes("public cible"));
      const totIndex = headers.findIndex(h => h.toLowerCase().includes("certifié tot"));

      const container = document.getElementById("cards");
      container.innerHTML = "";

      const cardsData = [];

      json.table.rows.forEach(row => {
        const cells = row.c;
        const name = cells[nameIndex]?.v || "—";
        const domaines = cells[domainesIndex]?.v || "—";
        const sessions = cells[sessionsIndex]?.v || "—";
        const email = cells[emailIndex]?.v || "—";
        const phone = cells[phoneIndex]?.v || "—";
        const org = cells[orgIndex]?.v || "—";
        const publicTarget = cells[publicIndex]?.v || "—";
        const tot = cells[totIndex]?.v || "—";

        const cardHTML = `
          <div class="card" data-name="${name.toLowerCase()}" data-session="${sessions.toLowerCase()}">
            <h3>${name}</h3>
            📧 <b>Email :</b> ${email}<br>
            📱 <b>Téléphone :</b> ${phone}<br>
            🏛️ <b>Organisation :</b> ${org}<br>
            🎓 <b>Domaines :</b> ${domaines}<br>
            🎤 <b>Sessions JCI :</b> ${sessions}<br>
            👥 <b>Public cible :</b> ${publicTarget}<br>
            ✅ <b>Certifié TOT :</b> ${tot}
          </div>
        `;

        cardsData.push({ html: cardHTML, name: name.toLowerCase(), sessions: sessions.toLowerCase() });
      });

      // Display all cards initially
      cardsData.forEach(c => container.innerHTML += c.html);

      // Live search filter
      const input = document.getElementById("searchInput");
      input.addEventListener("input", () => {
        const val = input.value.toLowerCase();
        container.innerHTML = "";
        cardsData
          .filter(c => c.name.includes(val) || c.sessions.includes(val))
          .forEach(c => container.innerHTML += c.html);
      });
    }

    window.onload = fetchData;
  </script>

</body>
</html>
